<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose'
        });
    </script>
    <style>
        body {
            margin: 0;
            padding: 40px;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .mermaid {
            background: white;
        }
    </style>
</head>
<body>
    <div class="mermaid">
sequenceDiagram
    actor Admin as âš™ï¸ Quáº£n trá»‹ viÃªn<br/>(Admin)
    participant UI as ğŸ–¥ï¸ Giao diá»‡n<br/>(Admin Dashboard)
    participant Server as âš™ï¸ Server<br/>(Backend)
    participant DB as ğŸ’¾ Database

    Note over Admin,DB: UC10.6: XÃ³a user

    Admin->>UI: 1. Click "XÃ³a" trÃªn user
    UI->>Server: 2. GET /api/admin/users/{id}/can-delete
    Server->>DB: 3. Kiá»ƒm tra activities<br/>SELECT COUNT(*) FROM Applications WHERE candidate_id = ?<br/>+ SELECT COUNT(*) FROM Jobs WHERE recruiter_id = ?
    
    alt CÃ³ hoáº¡t Ä‘á»™ng (Applications/Jobs)
        DB-->>Server: 4a. Count > 0
        Server-->>UI: 5a. Error "CÃ³ hoáº¡t Ä‘á»™ng"
        UI-->>Admin: 6a. âŒ "KhÃ´ng thá»ƒ xÃ³a user nÃ y<br/>vÃ¬ Ä‘Ã£ cÃ³ [N] hoáº¡t Ä‘á»™ng trong há»‡ thá»‘ng"<br/>+ Äá» xuáº¥t: "KhÃ³a tÃ i khoáº£n" thay vÃ¬ xÃ³a
    else KhÃ´ng cÃ³ hoáº¡t Ä‘á»™ng
        DB-->>Server: 4b. Count = 0
        Server-->>UI: 5b. Can delete
        UI-->>Admin: 6b. âš ï¸ YÃªu cáº§u nháº­p email Ä‘á»ƒ xÃ¡c nháº­n<br/>"Nháº­p email cá»§a user Ä‘á»ƒ xÃ¡c nháº­n xÃ³a"
        Admin->>UI: 7b. Nháº­p email xÃ¡c nháº­n
        
        alt Email khÃ´ng khá»›p
            UI-->>Admin: 8ba. âŒ "Email khÃ´ng khá»›p"
        else Email khá»›p
            Admin->>UI: 8bb. Nháº¥n "XÃ¡c nháº­n xÃ³a"
            UI->>Server: 9bb. DELETE /api/admin/users/{id}
            Server->>DB: 10bb. UPDATE Users<br/>SET status = 'deleted',<br/>deleted_at = NOW()<br/>(Soft delete)
            DB-->>Server: 11bb. Deleted
            
            Server->>DB: 12bb. INSERT INTO AdminLogs<br/>(admin_id, action, target_user)
            DB-->>Server: 13bb. Log saved
            
            Server-->>UI: 14bb. Success
            UI-->>Admin: 15bb. âœ… "ÄÃ£ xÃ³a user"
        end
    end

    </div>
</body>
</html>