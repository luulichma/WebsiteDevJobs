<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose'
        });
    </script>
    <style>
        body {
            margin: 0;
            padding: 40px;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .mermaid {
            background: white;
        }
    </style>
</head>
<body>
    <div class="mermaid">
sequenceDiagram
    actor Admin as ‚öôÔ∏è Qu·∫£n tr·ªã vi√™n<br/>(Admin)
    participant UI as üñ•Ô∏è Giao di·ªán<br/>(Admin Dashboard)
    participant Server as ‚öôÔ∏è Server<br/>(Backend)
    participant DB as üíæ Database
    participant Email as üìß Email Service

    Note over Admin,Email: UC10.5: Ch·ªânh s·ª≠a th√¥ng tin user

    Admin->>UI: 1. Click "S·ª≠a" tr√™n user
    UI-->>Admin: 2. Hi·ªÉn th·ªã form ch·ªânh s·ª≠a<br/>(Name, Phone, Role, Status)
    Admin->>UI: 3. Ch·ªânh s·ª≠a th√¥ng tin
    Admin->>UI: 4. Nh·∫•n "L∆∞u"
    
    UI->>Server: 5. PUT /api/admin/users/{id}<br/>(updated data)
    Server->>DB: 6. Ki·ªÉm tra email unique<br/>SELECT COUNT(*) FROM Users<br/>WHERE email = ? AND user_id != ?
    
    alt Email ƒë√£ t·ªìn t·∫°i
        DB-->>Server: 7a. Count > 0
        Server-->>UI: 8a. Error "Email duplicate"
        UI-->>Admin: 9a. ‚ùå Hi·ªÉn th·ªã l·ªói<br/>"Email n√†y ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng"
    else Email h·ª£p l·ªá (ho·∫∑c kh√¥ng ƒë·ªïi)
        DB-->>Server: 7b. Count = 0 (OK)
        Server->>DB: 8b. UPDATE Users<br/>SET full_name=?, phone=?,<br/>role=?, status=?, updated_at=NOW()<br/>WHERE user_id = ?
        DB-->>Server: 9b. Updated
        
        Server->>DB: 10b. INSERT INTO AdminLogs<br/>(admin_id, action, target_user, changes)
        DB-->>Server: 11b. Log saved
        
        Server->>Email: 12b. G·ª≠i email th√¥ng b√°o<br/>"Th√¥ng tin t√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t"
        Email-->>Server: 13b. Email sent
        
        Server-->>UI: 14b. Success
        UI-->>Admin: 15b. ‚úÖ "C·∫≠p nh·∫≠t th√†nh c√¥ng"
    end

    </div>
</body>
</html>